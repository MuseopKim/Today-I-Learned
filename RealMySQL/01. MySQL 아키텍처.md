------



### MySQL 엔진

1. 요청된 SQL 문장을 분석하거나 최적화 하는 등 DBMS의 두뇌에 해당하는 처리를 수행
2. 클라이언트로부터의 접속 및 쿼리 요청을 처리하는 커넥션 핸들러, SQL 파서 및 전처리기, 쿼리의 최적화된 실행을 위한 옵티마이저가 중심을 이룬다.
   - 커넥션 핸들러
   - SQL 파서 & 전처리기
   - SQL 옵티마이저
3. 성능 향상을 위한 MyISAM의 키 캐시나 InnoDB의 버퍼 풀과 같은 보조 저장소 기능이 포함 되어 있다.



### 스토리지 엔진

1. 실제 데이터를 디스크 스토리지에 저장하거나 디스크 스토리지로부터 읽어오는 기능을 담당한다.
2. MySQL 엔진은 오직 하나지만 스토리지 엔진은 여러 개를 동시에 사용할 수 있다.
3. 다음과 같이 테이블이 사용할 스토리지 엔진을 지정하면 이후 해당 테이블은 지정된 스토리지 엔진이 전담하여 처리한다.

```bash
mysql> CREATE TABLE test_table (fd1 INT, fd2 INT) ENGINE=INNODB
```



### 핸들러 API

- 핸들러 요청 : 각 스토리지 엔진에게 읽기 또는 쓰기를 요청하는데, 이러한 요청들을 핸들러 요청이라 함
- 핸들러 API : 핸들러 요청에 사용되는 API
- 핸들러 API를 통해 MySQL 엔진과 InnoDB 스토리지 엔진 사이에 데이터 교환이 발생



---



## MySQL 스레딩 구조

MySQL 서버는 프로세스 기반이 아닌 스레드 기반으로 작동한다. 이러한 스레드는 포그라운드, 백그라운드 스레드로 구분할 수 있다.



### 포그라운드 스레드(클라이언트 스레드)

- MySQL 서버에 접속된 클라이언트의 수만큼 존재
- 각 클라이언트 사용자가 요청하는 쿼리 문장을 처리
- 사용자가 작업을 마치고 커넥션을 종료하면 해당 커넥션을 담당하던 스레드는 다시 스레드 풀로 되돌아간다.
- thread_cache_size를 통해 총 스레드 수를 관리한다.
- 버퍼나 캐시까지만 처리하고 나머지 버퍼로부터 디스크까지 기록하는 작업은 백그라운드 스레드가 처리



### 백그라운드 스레드

- 쓰기 스레드 : 버퍼의 데이터를 디스크로 내려 씀
- 쓰기 작업을 버퍼링해서 일괄 처리하는 기능이 탑재되어 있으며, InnoDB도 이러한 방식으로 처리



---



## 메모리 할당 및 사용 구조

MySQL의 메모리 공간은 글로벌 메모리 영역과 로컬 메모리 영역으로 구분할 수 있다.



### 글로벌 메모리 영역

클라이언트 스레드의 수와 무관하게 하나의 메모리 공간만을 할당한다. 모든 스레드에 의해 공유되는 메모리



### 로컬 메모리 영역

- 클라이언트 스레드가 쿼리를 처리하는 데 사용하는 메모리 영역
- 각 클라이언트 스레드별로 독립적으로 할당되며 공유되지 않는 메모리 영역
- 각 쿼리의 용도별로 필요할때만 공간이 할당되고 필요하지 않은 경우 메모리 공간을 할당하지 않을 수 있음 (소트 버퍼, 조인 버퍼)
- 커넥션 버퍼나 결과 버퍼의 경우 커넥션이 열려 있는 동안 계속 할당된 상태를 유지



---