---

   

   트랜잭션은 작업의 완전성을 보장해 준다. 즉, 한 단위의 작업을 모두 완벽하게 처리하지 못 할 경우 원 상태로 복구해서 작업의 일부만 적용 되는 현상이 발생되지 않게 만들어주는 기능이다.

   잠금과 트랜잭션은 얼핏 서로 비슷한 개념 같아 보이기도 하는데, 잠금은 동시성을 제어하기 위한 기능이고 트랜잭션은 데이터의 정합성을 보장하기 위한 기능이다.

   잠금은 여러 커넥션에서 동시에 동일한 자원을 요청할 경우 순서대로 한 시점에는 하나의 커넥션만 변경할 수 있게 해준다.

   트랜잭션 격리수준이란, 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지를 결정하는 레벨이다.

## MySQL에서의 트랜잭션

   트랜잭션은 하나의 논리적인 작업 단위에 하나의 쿼리든, 그 이상이든 관계 없이 논리적인 한 단위 자체가 100% 적용 되거나(Commit) 적용되지 않아야 함을(Rollback) 보장해준다. MySQL의 InnoDB 스토리지 엔진은 이러한 트랜잭션을 보장하며, 부분 업데이트를 방지하여 데이터의 정합성을 맞출 수 있도록 돕는다.

```sql
try {
	START TRANSACTION;
	INSERT INTO table_a ...;
	INSERT INTO table_b ...;
	COMMIT;
} catch (exception) {
	ROLLBACK;
}
```

### 트랜잭션 주의사항

1. 데이터베이스 커넥션을 가지고 있는 범위와 트랜잭션이 활성화 돼 있는 프로그램의 범위를 최소화 해야 한다.
2. 외부 API 작업이 있는 경우 반드시 트랜잭션에서 배제해야 한다.
    
    ⇒ API에 장애가 발생 할 경우 DBMS 서버가 높은 부하 상태로 빠지거나 위험한 상태에 빠지는 경우가 빈번히 나타난다.
    

---

## MySQL 엔진의 잠금

MySQL 엔진 레벨의 잠금은 모든 스토리지 엔진에 영향을 미치지만, 스토리지 엔진 레벨의 잠금은 스토리지 엔진 간 상호 영향을 미치지 않는다.

### 글로벌 락

MySQL 서버 전체에 영향을 주는 MySQL에서 제공하는 락 중에 가장 범위가 큰 잠금을 말한다. "FLUSH TABLES WITH READ LOCK" 명령으로 획득할 수 있다. 만약 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT 이외에 다른 문장은 대기 상태로 남게 된다. mysqldump로 일관된 백업을 받아야 할 때 사용한다.

### 테이블 락

개별 테이블 단위로 설정되는 잠금을 말한다. 명시적 또는 묵시적으로 획득이 가능한데, "LOCK TABLES table_name[ READ | WRITE ]" 명령으로 특정 테이블의 락을 획득할 수 있다. 명시적으로 획득한 잠금은 UNLOCK TABLES 명령으로 잠금을 해제할 수 있다.

묵시적 테이블 락은 MyISAM, MEMORY테이블에 데이터를 변경하는 쿼리를 실행하면 발생한다. InnoDB 테이블의 경우 스토리지 엔진 차원에서 레코드 기반의 잠금을 제공하기 때문에 단순 데이터 변경 쿼리로 묵시적 테이블 락이 설정되지는 않는다. DML은 무시되지만 DDL의 경우에는 영향을 미친다.

### 유저 락

GET_LOCK() 함수를 이용해서 임의로 잠금을 설정한다. 이 잠금의 대상은 테이블이나 레코드가 아니다. 사용자가 지정한 문자열에 대한 잠금이다.

### 네임 락

데이터베이스의 이름을 변경하는 경우 획득하는 잠금. RENAME TABLE a TO b와 같이 테이블의 이름을 변경하는 경우 자동으로 획득하는 잠금이다.
