# 스프링 삼각형

스프링을 이해하는 데는 POJO를 기반으로 스프링 삼각형이라는 IoC / DI, AOP, PSA 라는 스프링 3대 프로그래밍 모델에 대한 이해가 필요하다.

스프링은 거대함 속에 단순함을 가지고 있는데 바로 그 단순함이 스프링 삼각형이다.

---

## IoC/DI - 제어의 역전 / 의존성 주입

### 의존성

의존성은 전체가 부분에 의존하는 것을 말한다. 즉, 자바에서는 객체와 의존되는 객체 사이의 집합관계를 말한다.

### 제어의 역전

제어의 권한이 프레임워크에 의해 주어지는 것. 구현 객체는 실행하는 역할만 담당하고, 프로그램의 제어 흐름은 Configuration 객체가 가져간다. 이렇게 제어 흐름을 직접 제어하는 것이 아니라 외부에서 관리하는 것을 제어의 역전(IoC)라 한다.

---

## AOP (Aspect-Oriented Programming)

있는 그대로 번역하면 관점 지향 프로그래밍을 말한다. 스프링 DI가 의존성 (new)에 대한 주입이라면 AOP는 로직의 주입이라 할 수 있다.

다수의 모듈에 공통적으로 나타나는 로직(예를 들어 로깅, 보안, 트랜잭션)이 존재하는데, 이를 횡단 관심사라고 한다. 핵심 관심사는 모듈별로 다르지만 횡단 관심사는 모듈별로 반복되어 중복해서 나타난다.

스프링 AOP의 핵심은 아래 세 개의 문장으로 요약할 수 있다.

- 스프링 AOP는 인터페이스 기반이다.
- 스프링 AOP는 프록시 기반이다.
- 스프링 AOP는 런타임 기반이다.

### Pointcut - Aspect 적용 위치 지정자

Pointcut은 횡단 관심사를 적용 할 타겟 메서드를 선택하는 지정자라 할 수 있다.

```java
@Aspect
public class MyAspect {

	@Before("execution(* runSomething())")
	public void before(JoinPoint joinPoint) {
		...
	}
}
```

Pointcut에는 다음과 같이 정규식과 AspectJ 표현식 등을 사용할 수 있다.

```java
[접근제한자 패턴] [리턴타입 패턴] [패키지&클래스 패턴] 메서드이름패턴(파라미터 패턴) [throws 예외패턴]
```

### JoinPoint - 연결가능한 지점

Pointcut은 JoinPoint의 부분집합이라 할 수 있다. Pointcut의 후보가 되는 모든 메서드들이 JoinPoint, 즉 Aspect 적용이 가능한 지점이 된다.

스프링 AOP에서의 JoinPoint는 스프링 프레임워크가 관리하는 빈의 모든 메서드에 해당된다.

JoinPoint 파라미터를 이용하면 실행 시점에 실제 호출된 메서드가 무엇인지, 실제 호출된 메서드를 소유한 객체는 무엇인지, 호출된 메서드의 파라미터는 무엇인지 등 호출된 메서드에 관한 전반적인 세부사항을 확인할 수 있다.

- 광의의 JoinPoint는 Aspect 적용이 가능한 모든 지점을 말한다.
- 협의의 JoinPoint는 호출된 객체의 메서드이다.

### Advice - 언제 무엇을 할지

Advice는 Pointcut에 적용할 로직(메서드)를 의미한다. 즉, Pointcut에 언제 무엇을 적용할지를 정의한 메서드라 할 수 있다.

### Aspect - Advisor의 집합체

AOP의 Aspect는 여러 개의 Advice[언제(When), 무엇을(What)], Pointcut[어디에(Where)]의 결합체를 의미하는 용어이다.

```java
									Aspect = Advice들 + Pointcut들
```

### Advisor - 어디서, 언제, 무엇을

스프링이 발전해오면서 이제는 쓰지 말라고 권고하는 기능이다. 현재는 다수의 Advice, Pointcut을 다양하게 조합할 수 있는 Aspect가 나왔기 때문에 하나의 Advice, Pointcut만을 결합하는 Advisor를 사용 할 필요가 없어졌다.

```java
									Advisor = 한 개의 Advice + 한 개의 Pointcut
```

---

## PSA(Portable Service Abstraction) - 일관성 있는 서비스 추상화

서비스 추상화의 예로 JDBC를 들 수 있다. JDBC라는 표준 스펙이 있기 때문에 어떤 DB를 사용하던 공통된 방식으로 코드를 작성할 수 있다.
이런게 가능한 이유는 어댑터 패턴을 사용 했기 때문이다. 이처럼 어댑터 패턴을 적용해서 같은 일을 하는 다수의 기술을 공통의 인터페이스로 제어할 수 있게 한 것을 **서비스 추상화**라고 한다.

스프링은 제각각인 API를 위한 어댑터를 제공함으로써 실제로 어떤 기술을 쓰던 일관된 방식으로 코드를 작성할 수 있게 지원한다. 이처럼 일관성 있는 방식으로 서비스 추상화를 해준다고 해서 이를 PSA라 한다.

스프링은 ORM, 캐시, 트랜잭션 등 다양한 기술에 대한 PSA를 제공한다.
