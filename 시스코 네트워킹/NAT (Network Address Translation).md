# NAT (Network Address Transation)

## IP 주소의 변환 NAT

한쪽 네트워크의 IP 주소가 다른 네트워크로 넘어갈 때 변환이 되어서 넘어가는 것

다음과 같은 이유로 사용하게 된다.

- 내부의 내부의 네트워크에는 비공인 IP 주소를 사용하고 외부 인터넷으로 나가는 경우에만 공인 IP 주소를 사용하고자 하는 경우
  ⇒ 내부의 모든 PC나 호스트에 부여할 공인 주소는 한정되어 있다. 그러므로 모든 인터넷을 하고자 하는 경우에는, 내부에서는 비공인 주소를 사용하다가 외부로 나갈 때만 공인 주소를 부여받아 나가는 방식을 사용한다. 다수의 비공인 IP 주소 사용자가 인터넷을 사용할 수 있기 때문이다.
- 기존에 사용하던 ISP에서 새로운 ISP로 변경 시 내부 전체의 IP를 변경하지 않고 기존의 IP 주소를 그대로 사용하고자 하는 경우
  ⇒ 원래 ISP를 이전하는 경우 네트워크 주소가 바뀌기 때문에, 이 경우 전체의 IP 주소를 다시 바꿔야 한다.
- 2개의 인트라넷을 서로 합하려 할 때 두 네트워크의 IP가 서로 겹치는 경우
  ⇒ 서로 비공인 주소를 사용하던 두 네트워크를 연결하는 경우 사용하던 IP 주소 영역이 겹칠 수 있다. 이 때 NAT를 사용하면 두 네트워크의 주소를 모두 변경하지 않고서도 이 문제를 해결할 수 있다.
- TCP 로드 분배가 필요한 경우
  ⇒ 밖에서는 하나의 주소로 보이는 호스트가 내부에서는 여러개의 호스트에 매핑되도록 해서 서버의 로드를 분배하는 기술

**Inside Local 주소**

내부 네트워크에서 사용하는 비공인 주소

**Inside Global 주소**

외부로 나갈 때 변환되어 나가는 주소

### NAT 동작 순서

1. 내부에 있는 호스트(10.1.1.1)가 라우터를 거치게 되면 NAT 테이블을 거쳐가면서 주소가(172.16.217.1) 바뀐다. 그 내용은 NAT 테이블에 보관된다.
2. 외부에서는 바뀐 주소(172.16.217.1)로만 인식을 하게 된다.
3. 외부의 호스트가 이에 응답을 할 때 목적지 주소를 바뀐 주소(172.16.217.1)로 보내게 된다.
4. 이 때, 라우터는 다시 이 주소를 NAT 테이블을 이용해서 원래의 주소로(10.1.1.1) 바꾼 뒤 내부 네트워크로 전달을 한다.
5. 이렇게 내부에 있는 호스트와 외부의 호스트 사이에 통신이 가능해진다.
